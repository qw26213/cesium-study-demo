class canvasTopopups {
	constructor(obj) {
		if(this.style==undefined) this.style={};
		if(obj==undefined) obj={}
		//图片对象
		this.style.imageUrl = obj.imageUrl==undefined?"./img/textures/textPnl.png":obj.imageUrl;
		this.style.width = obj.width==undefined?300:obj.width;
		this.style.height = obj.height==undefined?140:obj.height;
		this.style.font = obj.font==undefined?"55px 楷体":obj.font;

		if (!this._canvas) {
			this._canvas = document.createElement("canvas");
			this._canvas.width = this.style.width;
			this._canvas.height = this.style.height;
		}

		if (!this._pngImage) {
			let img = new Image(this.style.width, this.style.height);
			img.crossOrigin = "Anonymous";
			img.src = this.style.imageUrl;
			img.onload = () => {
				this._pngImage = img;
				this._updateCanvas();
			};
		}
		this._updateCanvas();
	}
	get text() {
		return this.style.text;
	}
	set text(val) {
		this.style.text = val;
		this._updateCanvas();
	}
	_updateCanvas() {
		if (!this._pngImage || !this._canvas) {
			return;
		}

		let canvas = this._canvas;
		let ctx = canvas.getContext("2d");
		ctx.clearRect(0, 0, canvas.width, canvas.height);
		//绘制图片
		ctx.drawImage(this._pngImage, 0, 0);

		//绘制文字
		ctx.fillStyle = "rgb(255, 255, 255)";
		ctx.font = this.style.font;
		ctx.textBaseline = "middle";
		ctx.textAlign="center"; 
		ctx.fillText(this.style.text, canvas.width/2, canvas.height / 2);

		let newImg = new Image(canvas.width, canvas.height);
		newImg.src = canvas.toDataURL("image/png");

		//将图片赋予给矢量对象进行显示，this.image是父类的属性
		this.image = newImg;
	}
}
