<!doctype html>
<html>

<head>
    <title>Cesium002</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" href="../Build/Cesium/Widgets/widgets.css">
    <script type="text/javascript" src="../Build/Cesium/Cesium.js"></script>
    <style>
        div,
        body {
            padding: 0;
            margin: 0;
        }

        .cesium-widget-credits {
            display: none !important;
        }
    </style>

<body>
    <div id="cesiumcontainer" style="width:100%;height:100%"></div>

    <script type="module">
        import { BaiduImageryProvider } from "./BaiduImageryProvider.js"
        // 服务负载子域
        var subdomains = ['0', '1', '2', '3', '4', '5', '6', '7'];
        var viewer = new Cesium.Viewer("cesiumcontainer", {
            //搜索框
            geocoder: false,
            //home键
            homeButton: false,
            // 动画控件
            animation: false,
            //全屏按钮
            fullscreenButton: false,
            //场景模式选择器
            sceneModePicker: false,
            //时间轴
            timeline: false,
            //导航提示
            navigationHelpButton: false,
            //地图选择器
            baseLayerPicker: false,
            imageryProvider: new BaiduImageryProvider({
                url: "http://api0.map.bdimg.com/customimage/tile?&x={x}&y={y}&z={z}&scale=1&customid=darkgreen"
            })

        })
        var promise = Cesium.KmlDataSource.load('./data/test.kml',
            {
                camera: viewer.scene.camera,
                canvas: viewer.scene.canvas
            })
        promise.then(datasource => {
            viewer.dataSources.add(datasource);
            viewer.zoomTo(datasource)
            datasource.entities.values.forEach(enetity => {
                enetity.polygon.outlineColor = Cesium.Color.RED;
                enetity.polygon.material = Cesium.Color.BLUE;
                enetity.polygon.height = 1000;
                enetity.polygon.extrudedHeight = 2000;

            })
        })






        // 申明一个XMLHttpRequest
        var request = new XMLHttpRequest();
        // 设置请求方法与路径
        request.open("get", './data/test.kml');
        // 不发送数据到服务器
        request.send(null);
        //XHR对象获取到返回信息后执行
        request.onload = function () {
            // 解析获取到的数据
            var parser = new DOMParser();
            var xmlDoc = parser.parseFromString(request.responseText, "text/xml");
            console.log(xmlDoc);
            let finds = xmlDoc.getElementsByTagName('coordinates');   //获取find节点
            var count = finds.length;
       
            for (let i = 0; i < count; i++) {
                var res = finds[i].textContent
                var res1 = finds[i].textContent.replace(/[\r\n]/g, "");//删除换行
                var positions = res1.split(' ');//以空间为辨识 打断字符串
                var poses = []
                positions.forEach((item, index) => {
                    if (item.length > 0) {
                        var pos = item.split(',')
                        poses.push(Number(pos[0]))
                        poses.push(Number(pos[1]))
                        poses.push(Number(pos[2]))
                    }

                })
                viewer.entities.add({
                    name: "hbei",
                    polygon: {
                        hierarchy: {
                            positions: Cesium.Cartesian3.fromDegreesArrayHeights(poses)
                        },
                        height: 10000,
                        extrudedHeight: 20000,
                        material: Cesium.Color.RED,
                        outline: true,
                        outlineColor: Cesium.Color.ORANGE
                    }
                })

            }

        }

    </script>
</body>

</html>